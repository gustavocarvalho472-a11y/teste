{"ast":null,"code":"// UtilitÃ¡rios para detecÃ§Ã£o de anomalias estatÃ­sticas\n\n// Calcula mÃ©dia\nexport const calculateMean = values => {\n  return values.reduce((sum, val) => sum + val, 0) / values.length;\n};\n\n// Calcula desvio padrÃ£o\nexport const calculateStdDev = (values, mean) => {\n  const squaredDiffs = values.map(val => Math.pow(val - mean, 2));\n  const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;\n  return Math.sqrt(variance);\n};\n\n// Calcula Z-score (quantos desvios padrÃ£o da mÃ©dia)\nexport const calculateZScore = (value, mean, stdDev) => {\n  if (stdDev === 0) return 0;\n  return (value - mean) / stdDev;\n};\n\n// Classifica severidade da anomalia\nexport const classifySeverity = zScore => {\n  const absZScore = Math.abs(zScore);\n  if (absZScore > 3) return 'critical';\n  if (absZScore > 2) return 'moderate';\n  return 'normal';\n};\n\n// ObtÃ©m cor baseada na severidade\nexport const getSeverityColor = severity => {\n  switch (severity) {\n    case 'critical':\n      return '#ef4444';\n    case 'moderate':\n      return '#f59e0b';\n    case 'normal':\n      return '#10b981';\n  }\n};\n\n// ObtÃ©m Ã­cone baseado na severidade\nexport const getSeverityIcon = severity => {\n  switch (severity) {\n    case 'critical':\n      return 'ðŸ”´';\n    case 'moderate':\n      return 'ðŸŸ¡';\n    case 'normal':\n      return 'ðŸŸ¢';\n  }\n};\n\n// Contexto de governo por ano\nexport const getGovernmentContext = year => {\n  if (year >= 2023) return 'Governo Lula 3';\n  if (year >= 2019) return 'Governo Bolsonaro';\n  if (year >= 2016) return 'Governo Temer';\n  if (year >= 2011) return 'Governo Dilma';\n  if (year >= 2003) return 'Governo Lula 1-2';\n  return 'Governo anterior';\n};\n\n// Eventos especiais por ano\nexport const getYearEvents = year => {\n  const events = [];\n  if (year === 2020 || year === 2021) {\n    events.push('ðŸ¦  Pandemia COVID-19');\n  }\n  if (year % 4 === 0) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Municipal');\n  }\n  if (year === 2018 || year === 2022) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Federal');\n  }\n  if (year === 2019) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n  if (year === 2023) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n  if (year === 2015 || year === 2016) {\n    events.push('âš ï¸ Crise EconÃ´mica');\n  }\n  return events;\n};\n\n// Detecta anomalias em sÃ©rie temporal anual\nexport const detectYearlyAnomalies = yearlyData => {\n  const values = yearlyData.map(d => d.value);\n  const mean = calculateMean(values);\n  const stdDev = calculateStdDev(values, mean);\n  return yearlyData.map(data => {\n    const zScore = calculateZScore(data.value, mean, stdDev);\n    const severity = classifySeverity(zScore);\n    const percentageDeviation = (data.value - mean) / mean * 100;\n    return {\n      year: data.year,\n      value: data.value,\n      mean,\n      stdDev,\n      zScore,\n      severity,\n      percentageDeviation,\n      isElectionYear: data.isElectionYear,\n      governmentContext: getGovernmentContext(data.year),\n      events: getYearEvents(data.year)\n    };\n  });\n};\n\n// Identifica as maiores anomalias\nexport const getTopAnomalies = (anomalies, limit = 3) => {\n  return [...anomalies].sort((a, b) => Math.abs(b.zScore) - Math.abs(a.zScore)).slice(0, limit);\n};\n\n// Calcula estatÃ­sticas gerais\nexport const calculateAnomalyStats = anomalies => {\n  const critical = anomalies.filter(a => a.severity === 'critical').length;\n  const moderate = anomalies.filter(a => a.severity === 'moderate').length;\n  const total = anomalies.length;\n  const electionYears = anomalies.filter(a => a.isElectionYear);\n  const nonElectionYears = anomalies.filter(a => !a.isElectionYear);\n  const electionAvg = calculateMean(electionYears.map(a => a.value));\n  const nonElectionAvg = calculateMean(nonElectionYears.map(a => a.value));\n  const electionPattern = (electionAvg - nonElectionAvg) / nonElectionAvg * 100;\n  return {\n    totalAnomalies: critical + moderate,\n    criticalCount: critical,\n    moderateCount: moderate,\n    normalCount: total - critical - moderate,\n    electionPattern,\n    maxAnomaly: Math.max(...anomalies.map(a => Math.abs(a.zScore))),\n    minAnomaly: Math.min(...anomalies.map(a => Math.abs(a.zScore)))\n  };\n};","map":{"version":3,"names":["calculateMean","values","reduce","sum","val","length","calculateStdDev","mean","squaredDiffs","map","Math","pow","variance","sqrt","calculateZScore","value","stdDev","classifySeverity","zScore","absZScore","abs","getSeverityColor","severity","getSeverityIcon","getGovernmentContext","year","getYearEvents","events","push","detectYearlyAnomalies","yearlyData","d","data","percentageDeviation","isElectionYear","governmentContext","getTopAnomalies","anomalies","limit","sort","a","b","slice","calculateAnomalyStats","critical","filter","moderate","total","electionYears","nonElectionYears","electionAvg","nonElectionAvg","electionPattern","totalAnomalies","criticalCount","moderateCount","normalCount","maxAnomaly","max","minAnomaly","min"],"sources":["/Users/gustavocarvalho/budget-dashboard/src/utils/anomalyDetection.ts"],"sourcesContent":["// UtilitÃ¡rios para detecÃ§Ã£o de anomalias estatÃ­sticas\n\nexport interface AnomalyData {\n  year: number;\n  month: number;\n  value: number;\n  mean: number;\n  stdDev: number;\n  zScore: number;\n  severity: 'critical' | 'moderate' | 'normal';\n  percentageDeviation: number;\n  context?: string;\n  icon?: string;\n}\n\nexport interface YearlyAnomaly {\n  year: number;\n  value: number;\n  mean: number;\n  stdDev: number;\n  zScore: number;\n  severity: 'critical' | 'moderate' | 'normal';\n  percentageDeviation: number;\n  isElectionYear: boolean;\n  governmentContext: string;\n  events: string[];\n}\n\n// Calcula mÃ©dia\nexport const calculateMean = (values: number[]): number => {\n  return values.reduce((sum, val) => sum + val, 0) / values.length;\n};\n\n// Calcula desvio padrÃ£o\nexport const calculateStdDev = (values: number[], mean: number): number => {\n  const squaredDiffs = values.map(val => Math.pow(val - mean, 2));\n  const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;\n  return Math.sqrt(variance);\n};\n\n// Calcula Z-score (quantos desvios padrÃ£o da mÃ©dia)\nexport const calculateZScore = (value: number, mean: number, stdDev: number): number => {\n  if (stdDev === 0) return 0;\n  return (value - mean) / stdDev;\n};\n\n// Classifica severidade da anomalia\nexport const classifySeverity = (zScore: number): 'critical' | 'moderate' | 'normal' => {\n  const absZScore = Math.abs(zScore);\n  if (absZScore > 3) return 'critical';\n  if (absZScore > 2) return 'moderate';\n  return 'normal';\n};\n\n// ObtÃ©m cor baseada na severidade\nexport const getSeverityColor = (severity: 'critical' | 'moderate' | 'normal'): string => {\n  switch (severity) {\n    case 'critical':\n      return '#ef4444';\n    case 'moderate':\n      return '#f59e0b';\n    case 'normal':\n      return '#10b981';\n  }\n};\n\n// ObtÃ©m Ã­cone baseado na severidade\nexport const getSeverityIcon = (severity: 'critical' | 'moderate' | 'normal'): string => {\n  switch (severity) {\n    case 'critical':\n      return 'ðŸ”´';\n    case 'moderate':\n      return 'ðŸŸ¡';\n    case 'normal':\n      return 'ðŸŸ¢';\n  }\n};\n\n// Contexto de governo por ano\nexport const getGovernmentContext = (year: number): string => {\n  if (year >= 2023) return 'Governo Lula 3';\n  if (year >= 2019) return 'Governo Bolsonaro';\n  if (year >= 2016) return 'Governo Temer';\n  if (year >= 2011) return 'Governo Dilma';\n  if (year >= 2003) return 'Governo Lula 1-2';\n  return 'Governo anterior';\n};\n\n// Eventos especiais por ano\nexport const getYearEvents = (year: number): string[] => {\n  const events: string[] = [];\n\n  if (year === 2020 || year === 2021) {\n    events.push('ðŸ¦  Pandemia COVID-19');\n  }\n\n  if (year % 4 === 0) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Municipal');\n  }\n\n  if (year === 2018 || year === 2022) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Federal');\n  }\n\n  if (year === 2019) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n\n  if (year === 2023) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n\n  if (year === 2015 || year === 2016) {\n    events.push('âš ï¸ Crise EconÃ´mica');\n  }\n\n  return events;\n};\n\n// Detecta anomalias em sÃ©rie temporal anual\nexport const detectYearlyAnomalies = (\n  yearlyData: { year: number; value: number; isElectionYear: boolean }[]\n): YearlyAnomaly[] => {\n  const values = yearlyData.map(d => d.value);\n  const mean = calculateMean(values);\n  const stdDev = calculateStdDev(values, mean);\n\n  return yearlyData.map(data => {\n    const zScore = calculateZScore(data.value, mean, stdDev);\n    const severity = classifySeverity(zScore);\n    const percentageDeviation = ((data.value - mean) / mean) * 100;\n\n    return {\n      year: data.year,\n      value: data.value,\n      mean,\n      stdDev,\n      zScore,\n      severity,\n      percentageDeviation,\n      isElectionYear: data.isElectionYear,\n      governmentContext: getGovernmentContext(data.year),\n      events: getYearEvents(data.year)\n    };\n  });\n};\n\n// Identifica as maiores anomalias\nexport const getTopAnomalies = (\n  anomalies: YearlyAnomaly[],\n  limit: number = 3\n): YearlyAnomaly[] => {\n  return [...anomalies]\n    .sort((a, b) => Math.abs(b.zScore) - Math.abs(a.zScore))\n    .slice(0, limit);\n};\n\n// Calcula estatÃ­sticas gerais\nexport const calculateAnomalyStats = (anomalies: YearlyAnomaly[]) => {\n  const critical = anomalies.filter(a => a.severity === 'critical').length;\n  const moderate = anomalies.filter(a => a.severity === 'moderate').length;\n  const total = anomalies.length;\n\n  const electionYears = anomalies.filter(a => a.isElectionYear);\n  const nonElectionYears = anomalies.filter(a => !a.isElectionYear);\n\n  const electionAvg = calculateMean(electionYears.map(a => a.value));\n  const nonElectionAvg = calculateMean(nonElectionYears.map(a => a.value));\n  const electionPattern = ((electionAvg - nonElectionAvg) / nonElectionAvg) * 100;\n\n  return {\n    totalAnomalies: critical + moderate,\n    criticalCount: critical,\n    moderateCount: moderate,\n    normalCount: total - critical - moderate,\n    electionPattern,\n    maxAnomaly: Math.max(...anomalies.map(a => Math.abs(a.zScore))),\n    minAnomaly: Math.min(...anomalies.map(a => Math.abs(a.zScore)))\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}