{"ast":null,"code":"// P0.2 - Função de Cálculo de Oportunidades\n\nexport function calcularOportunidade(dados) {\n  // 1. Média histórica (2020-2024)\n  const mediaContratos = dados.historico.reduce((acc, h) => acc + h.totalContratos, 0) / dados.historico.length;\n  const mediaValor = dados.historico.reduce((acc, h) => acc + h.valorExecutado, 0) / dados.historico.length;\n\n  // 2. Ajuste sazonal (maio = 5/12 do ano)\n  const fatorSazonal = 5 / 12;\n  const esperadoContratos = mediaContratos * fatorSazonal;\n  const esperadoValor = mediaValor * fatorSazonal;\n\n  // 3. Disponível\n  const disponivel = mediaValor - dados.anoAtual.executado;\n  const percentualExecutado = dados.anoAtual.executado / mediaValor * 100;\n  const percentualDisponivel = 100 - percentualExecutado;\n\n  // 4. Gap\n  const gapContratos = dados.anoAtual.fechados - esperadoContratos;\n  const gapPercentual = gapContratos / esperadoContratos * 100;\n\n  // 5. Projeção anual\n  const projecaoAno = dados.anoAtual.fechados / fatorSazonal;\n\n  // 6. Diferença financeira\n  const diferencaFinanceira = dados.anoAtual.executado - esperadoValor;\n  const diferencaFinanceiraPercent = diferencaFinanceira / esperadoValor * 100;\n\n  // 7. Orçamento livre (sem edital)\n  const orcamentoLivre = disponivel - dados.anoAtual.editaisAtivos.valor;\n\n  // 8. Determinar nível de oportunidade\n  let nivel;\n  if (gapPercentual <= -30) {\n    nivel = 'PREMIUM';\n  } else if (gapPercentual <= -15) {\n    nivel = 'FORTE';\n  } else {\n    nivel = 'BOA';\n  }\n  return {\n    municipio: dados.municipio,\n    estado: dados.estado,\n    categoria: dados.categoria,\n    nivel,\n    orcamento: {\n      total: Math.round(mediaValor),\n      executado: dados.anoAtual.executado,\n      disponivel: Math.round(disponivel),\n      percentualExecutado: Number(percentualExecutado.toFixed(1)),\n      percentualDisponivel: Number(percentualDisponivel.toFixed(1))\n    },\n    contratos: {\n      fechados: dados.anoAtual.fechados,\n      mediaAnual: Math.round(mediaContratos),\n      esperadoAteMes: Math.round(esperadoContratos),\n      gap: Math.round(gapContratos),\n      gapPercentual: Number(gapPercentual.toFixed(1)),\n      projecaoAno: Math.round(projecaoAno)\n    },\n    oportunidades: {\n      editaisAtivos: dados.anoAtual.editaisAtivos.quantidade,\n      valorEditais: dados.anoAtual.editaisAtivos.valor,\n      orcamentoLivre: Math.round(orcamentoLivre),\n      diferencaFinanceira: Math.round(diferencaFinanceira),\n      diferencaFinanceiraPercent: Number(diferencaFinanceiraPercent.toFixed(1))\n    },\n    historico: dados.historico.map(h => ({\n      ano: h.ano,\n      contratos: h.totalContratos,\n      valorExecutado: h.valorExecutado,\n      ticketMedio: Math.round(h.valorExecutado / h.totalContratos)\n    })),\n    comparacao: {\n      esperadoContratos: Math.round(esperadoContratos),\n      realContratos: dados.anoAtual.fechados,\n      esperadoValor: Math.round(esperadoValor),\n      realValor: dados.anoAtual.executado\n    }\n  };\n}\n\n// Formatadores de números\nexport const formatters = {\n  currency: value => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL',\n      notation: 'compact',\n      maximumFractionDigits: 2\n    }).format(value);\n  },\n  number: value => {\n    return new Intl.NumberFormat('pt-BR').format(value);\n  },\n  percent: value => {\n    return `${value > 0 ? '+' : ''}${value.toFixed(1)}%`;\n  }\n};","map":{"version":3,"names":["calcularOportunidade","dados","mediaContratos","historico","reduce","acc","h","totalContratos","length","mediaValor","valorExecutado","fatorSazonal","esperadoContratos","esperadoValor","disponivel","anoAtual","executado","percentualExecutado","percentualDisponivel","gapContratos","fechados","gapPercentual","projecaoAno","diferencaFinanceira","diferencaFinanceiraPercent","orcamentoLivre","editaisAtivos","valor","nivel","municipio","estado","categoria","orcamento","total","Math","round","Number","toFixed","contratos","mediaAnual","esperadoAteMes","gap","oportunidades","quantidade","valorEditais","map","ano","ticketMedio","comparacao","realContratos","realValor","formatters","currency","value","Intl","NumberFormat","style","notation","maximumFractionDigits","format","number","percent"],"sources":["/Users/gustavocarvalho/budget-dashboard/src/utils/oportunidadeCalculator.ts"],"sourcesContent":["// P0.2 - Função de Cálculo de Oportunidades\n\nimport { OportunidadeData, DadosHistoricos } from '../types/oportunidade';\n\nexport function calcularOportunidade(dados: DadosHistoricos): OportunidadeData {\n  // 1. Média histórica (2020-2024)\n  const mediaContratos = dados.historico.reduce((acc, h) => acc + h.totalContratos, 0) / dados.historico.length;\n  const mediaValor = dados.historico.reduce((acc, h) => acc + h.valorExecutado, 0) / dados.historico.length;\n\n  // 2. Ajuste sazonal (maio = 5/12 do ano)\n  const fatorSazonal = 5 / 12;\n  const esperadoContratos = mediaContratos * fatorSazonal;\n  const esperadoValor = mediaValor * fatorSazonal;\n\n  // 3. Disponível\n  const disponivel = mediaValor - dados.anoAtual.executado;\n  const percentualExecutado = (dados.anoAtual.executado / mediaValor) * 100;\n  const percentualDisponivel = 100 - percentualExecutado;\n\n  // 4. Gap\n  const gapContratos = dados.anoAtual.fechados - esperadoContratos;\n  const gapPercentual = (gapContratos / esperadoContratos) * 100;\n\n  // 5. Projeção anual\n  const projecaoAno = dados.anoAtual.fechados / fatorSazonal;\n\n  // 6. Diferença financeira\n  const diferencaFinanceira = dados.anoAtual.executado - esperadoValor;\n  const diferencaFinanceiraPercent = (diferencaFinanceira / esperadoValor) * 100;\n\n  // 7. Orçamento livre (sem edital)\n  const orcamentoLivre = disponivel - dados.anoAtual.editaisAtivos.valor;\n\n  // 8. Determinar nível de oportunidade\n  let nivel: 'PREMIUM' | 'FORTE' | 'BOA';\n  if (gapPercentual <= -30) {\n    nivel = 'PREMIUM';\n  } else if (gapPercentual <= -15) {\n    nivel = 'FORTE';\n  } else {\n    nivel = 'BOA';\n  }\n\n  return {\n    municipio: dados.municipio,\n    estado: dados.estado,\n    categoria: dados.categoria,\n    nivel,\n\n    orcamento: {\n      total: Math.round(mediaValor),\n      executado: dados.anoAtual.executado,\n      disponivel: Math.round(disponivel),\n      percentualExecutado: Number(percentualExecutado.toFixed(1)),\n      percentualDisponivel: Number(percentualDisponivel.toFixed(1))\n    },\n\n    contratos: {\n      fechados: dados.anoAtual.fechados,\n      mediaAnual: Math.round(mediaContratos),\n      esperadoAteMes: Math.round(esperadoContratos),\n      gap: Math.round(gapContratos),\n      gapPercentual: Number(gapPercentual.toFixed(1)),\n      projecaoAno: Math.round(projecaoAno)\n    },\n\n    oportunidades: {\n      editaisAtivos: dados.anoAtual.editaisAtivos.quantidade,\n      valorEditais: dados.anoAtual.editaisAtivos.valor,\n      orcamentoLivre: Math.round(orcamentoLivre),\n      diferencaFinanceira: Math.round(diferencaFinanceira),\n      diferencaFinanceiraPercent: Number(diferencaFinanceiraPercent.toFixed(1))\n    },\n\n    historico: dados.historico.map(h => ({\n      ano: h.ano,\n      contratos: h.totalContratos,\n      valorExecutado: h.valorExecutado,\n      ticketMedio: Math.round(h.valorExecutado / h.totalContratos)\n    })),\n\n    comparacao: {\n      esperadoContratos: Math.round(esperadoContratos),\n      realContratos: dados.anoAtual.fechados,\n      esperadoValor: Math.round(esperadoValor),\n      realValor: dados.anoAtual.executado\n    }\n  };\n}\n\n// Formatadores de números\nexport const formatters = {\n  currency: (value: number): string => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL',\n      notation: 'compact',\n      maximumFractionDigits: 2\n    }).format(value);\n  },\n\n  number: (value: number): string => {\n    return new Intl.NumberFormat('pt-BR').format(value);\n  },\n\n  percent: (value: number): string => {\n    return `${value > 0 ? '+' : ''}${value.toFixed(1)}%`;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}