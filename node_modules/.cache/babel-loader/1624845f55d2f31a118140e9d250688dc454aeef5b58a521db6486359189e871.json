{"ast":null,"code":"// UtilitÃ¡rios para detecÃ§Ã£o de anomalias estatÃ­sticas\n// Calcula mÃ©dia\nexport const calculateMean=values=>{return values.reduce((sum,val)=>sum+val,0)/values.length;};// Calcula desvio padrÃ£o\nexport const calculateStdDev=(values,mean)=>{const squaredDiffs=values.map(val=>Math.pow(val-mean,2));const variance=squaredDiffs.reduce((sum,val)=>sum+val,0)/values.length;return Math.sqrt(variance);};// Calcula Z-score (quantos desvios padrÃ£o da mÃ©dia)\nexport const calculateZScore=(value,mean,stdDev)=>{if(stdDev===0)return 0;return(value-mean)/stdDev;};// Classifica severidade da anomalia\nexport const classifySeverity=zScore=>{const absZScore=Math.abs(zScore);if(absZScore>3)return'critical';if(absZScore>2)return'moderate';return'normal';};// ObtÃ©m cor baseada na severidade\nexport const getSeverityColor=severity=>{switch(severity){case'critical':return'#ef4444';case'moderate':return'#f59e0b';case'normal':return'#10b981';}};// ObtÃ©m Ã­cone baseado na severidade\nexport const getSeverityIcon=severity=>{switch(severity){case'critical':return'ðŸ”´';case'moderate':return'ðŸŸ¡';case'normal':return'ðŸŸ¢';}};// Contexto de governo por ano\nexport const getGovernmentContext=year=>{if(year>=2023)return'Governo Lula 3';if(year>=2019)return'Governo Bolsonaro';if(year>=2016)return'Governo Temer';if(year>=2011)return'Governo Dilma';if(year>=2003)return'Governo Lula 1-2';return'Governo anterior';};// Eventos especiais por ano\nexport const getYearEvents=year=>{const events=[];if(year===2020||year===2021){events.push('ðŸ¦  Pandemia COVID-19');}if(year%4===0){events.push('ðŸ—³ï¸ EleiÃ§Ã£o Municipal');}if(year===2018||year===2022){events.push('ðŸ—³ï¸ EleiÃ§Ã£o Federal');}if(year===2019){events.push('ðŸ‘¤ MudanÃ§a de Governo');}if(year===2023){events.push('ðŸ‘¤ MudanÃ§a de Governo');}if(year===2015||year===2016){events.push('âš ï¸ Crise EconÃ´mica');}return events;};// Detecta anomalias em sÃ©rie temporal anual\nexport const detectYearlyAnomalies=yearlyData=>{const values=yearlyData.map(d=>d.value);const mean=calculateMean(values);const stdDev=calculateStdDev(values,mean);return yearlyData.map(data=>{const zScore=calculateZScore(data.value,mean,stdDev);const severity=classifySeverity(zScore);const percentageDeviation=(data.value-mean)/mean*100;return{year:data.year,value:data.value,mean,stdDev,zScore,severity,percentageDeviation,isElectionYear:data.isElectionYear,governmentContext:getGovernmentContext(data.year),events:getYearEvents(data.year)};});};// Identifica as maiores anomalias\nexport const getTopAnomalies=function(anomalies){let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;return[...anomalies].sort((a,b)=>Math.abs(b.zScore)-Math.abs(a.zScore)).slice(0,limit);};// Calcula estatÃ­sticas gerais\nexport const calculateAnomalyStats=anomalies=>{const critical=anomalies.filter(a=>a.severity==='critical').length;const moderate=anomalies.filter(a=>a.severity==='moderate').length;const total=anomalies.length;const electionYears=anomalies.filter(a=>a.isElectionYear);const nonElectionYears=anomalies.filter(a=>!a.isElectionYear);const electionAvg=calculateMean(electionYears.map(a=>a.value));const nonElectionAvg=calculateMean(nonElectionYears.map(a=>a.value));const electionPattern=(electionAvg-nonElectionAvg)/nonElectionAvg*100;return{totalAnomalies:critical+moderate,criticalCount:critical,moderateCount:moderate,normalCount:total-critical-moderate,electionPattern,maxAnomaly:Math.max(...anomalies.map(a=>Math.abs(a.zScore))),minAnomaly:Math.min(...anomalies.map(a=>Math.abs(a.zScore)))};};","map":{"version":3,"names":["calculateMean","values","reduce","sum","val","length","calculateStdDev","mean","squaredDiffs","map","Math","pow","variance","sqrt","calculateZScore","value","stdDev","classifySeverity","zScore","absZScore","abs","getSeverityColor","severity","getSeverityIcon","getGovernmentContext","year","getYearEvents","events","push","detectYearlyAnomalies","yearlyData","d","data","percentageDeviation","isElectionYear","governmentContext","getTopAnomalies","anomalies","limit","arguments","undefined","sort","a","b","slice","calculateAnomalyStats","critical","filter","moderate","total","electionYears","nonElectionYears","electionAvg","nonElectionAvg","electionPattern","totalAnomalies","criticalCount","moderateCount","normalCount","maxAnomaly","max","minAnomaly","min"],"sources":["/Users/gustavocarvalho/budget-dashboard/src/utils/anomalyDetection.ts"],"sourcesContent":["// UtilitÃ¡rios para detecÃ§Ã£o de anomalias estatÃ­sticas\n\nexport interface AnomalyData {\n  year: number;\n  month: number;\n  value: number;\n  mean: number;\n  stdDev: number;\n  zScore: number;\n  severity: 'critical' | 'moderate' | 'normal';\n  percentageDeviation: number;\n  context?: string;\n  icon?: string;\n}\n\nexport interface YearlyAnomaly {\n  year: number;\n  value: number;\n  mean: number;\n  stdDev: number;\n  zScore: number;\n  severity: 'critical' | 'moderate' | 'normal';\n  percentageDeviation: number;\n  isElectionYear: boolean;\n  governmentContext: string;\n  events: string[];\n}\n\n// Calcula mÃ©dia\nexport const calculateMean = (values: number[]): number => {\n  return values.reduce((sum, val) => sum + val, 0) / values.length;\n};\n\n// Calcula desvio padrÃ£o\nexport const calculateStdDev = (values: number[], mean: number): number => {\n  const squaredDiffs = values.map(val => Math.pow(val - mean, 2));\n  const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;\n  return Math.sqrt(variance);\n};\n\n// Calcula Z-score (quantos desvios padrÃ£o da mÃ©dia)\nexport const calculateZScore = (value: number, mean: number, stdDev: number): number => {\n  if (stdDev === 0) return 0;\n  return (value - mean) / stdDev;\n};\n\n// Classifica severidade da anomalia\nexport const classifySeverity = (zScore: number): 'critical' | 'moderate' | 'normal' => {\n  const absZScore = Math.abs(zScore);\n  if (absZScore > 3) return 'critical';\n  if (absZScore > 2) return 'moderate';\n  return 'normal';\n};\n\n// ObtÃ©m cor baseada na severidade\nexport const getSeverityColor = (severity: 'critical' | 'moderate' | 'normal'): string => {\n  switch (severity) {\n    case 'critical':\n      return '#ef4444';\n    case 'moderate':\n      return '#f59e0b';\n    case 'normal':\n      return '#10b981';\n  }\n};\n\n// ObtÃ©m Ã­cone baseado na severidade\nexport const getSeverityIcon = (severity: 'critical' | 'moderate' | 'normal'): string => {\n  switch (severity) {\n    case 'critical':\n      return 'ðŸ”´';\n    case 'moderate':\n      return 'ðŸŸ¡';\n    case 'normal':\n      return 'ðŸŸ¢';\n  }\n};\n\n// Contexto de governo por ano\nexport const getGovernmentContext = (year: number): string => {\n  if (year >= 2023) return 'Governo Lula 3';\n  if (year >= 2019) return 'Governo Bolsonaro';\n  if (year >= 2016) return 'Governo Temer';\n  if (year >= 2011) return 'Governo Dilma';\n  if (year >= 2003) return 'Governo Lula 1-2';\n  return 'Governo anterior';\n};\n\n// Eventos especiais por ano\nexport const getYearEvents = (year: number): string[] => {\n  const events: string[] = [];\n\n  if (year === 2020 || year === 2021) {\n    events.push('ðŸ¦  Pandemia COVID-19');\n  }\n\n  if (year % 4 === 0) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Municipal');\n  }\n\n  if (year === 2018 || year === 2022) {\n    events.push('ðŸ—³ï¸ EleiÃ§Ã£o Federal');\n  }\n\n  if (year === 2019) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n\n  if (year === 2023) {\n    events.push('ðŸ‘¤ MudanÃ§a de Governo');\n  }\n\n  if (year === 2015 || year === 2016) {\n    events.push('âš ï¸ Crise EconÃ´mica');\n  }\n\n  return events;\n};\n\n// Detecta anomalias em sÃ©rie temporal anual\nexport const detectYearlyAnomalies = (\n  yearlyData: { year: number; value: number; isElectionYear: boolean }[]\n): YearlyAnomaly[] => {\n  const values = yearlyData.map(d => d.value);\n  const mean = calculateMean(values);\n  const stdDev = calculateStdDev(values, mean);\n\n  return yearlyData.map(data => {\n    const zScore = calculateZScore(data.value, mean, stdDev);\n    const severity = classifySeverity(zScore);\n    const percentageDeviation = ((data.value - mean) / mean) * 100;\n\n    return {\n      year: data.year,\n      value: data.value,\n      mean,\n      stdDev,\n      zScore,\n      severity,\n      percentageDeviation,\n      isElectionYear: data.isElectionYear,\n      governmentContext: getGovernmentContext(data.year),\n      events: getYearEvents(data.year)\n    };\n  });\n};\n\n// Identifica as maiores anomalias\nexport const getTopAnomalies = (\n  anomalies: YearlyAnomaly[],\n  limit: number = 3\n): YearlyAnomaly[] => {\n  return [...anomalies]\n    .sort((a, b) => Math.abs(b.zScore) - Math.abs(a.zScore))\n    .slice(0, limit);\n};\n\n// Calcula estatÃ­sticas gerais\nexport const calculateAnomalyStats = (anomalies: YearlyAnomaly[]) => {\n  const critical = anomalies.filter(a => a.severity === 'critical').length;\n  const moderate = anomalies.filter(a => a.severity === 'moderate').length;\n  const total = anomalies.length;\n\n  const electionYears = anomalies.filter(a => a.isElectionYear);\n  const nonElectionYears = anomalies.filter(a => !a.isElectionYear);\n\n  const electionAvg = calculateMean(electionYears.map(a => a.value));\n  const nonElectionAvg = calculateMean(nonElectionYears.map(a => a.value));\n  const electionPattern = ((electionAvg - nonElectionAvg) / nonElectionAvg) * 100;\n\n  return {\n    totalAnomalies: critical + moderate,\n    criticalCount: critical,\n    moderateCount: moderate,\n    normalCount: total - critical - moderate,\n    electionPattern,\n    maxAnomaly: Math.max(...anomalies.map(a => Math.abs(a.zScore))),\n    minAnomaly: Math.min(...anomalies.map(a => Math.abs(a.zScore)))\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}