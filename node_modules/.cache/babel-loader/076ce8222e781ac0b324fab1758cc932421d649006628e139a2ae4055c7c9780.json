{"ast":null,"code":"// P0.2 - Função de Cálculo de Oportunidades\nexport function calcularOportunidade(dados){// 1. Média histórica (2020-2024)\nconst mediaContratos=dados.historico.reduce((acc,h)=>acc+h.totalContratos,0)/dados.historico.length;const mediaValor=dados.historico.reduce((acc,h)=>acc+h.valorExecutado,0)/dados.historico.length;// 2. Ajuste sazonal (maio = 5/12 do ano)\nconst fatorSazonal=5/12;const esperadoContratos=mediaContratos*fatorSazonal;const esperadoValor=mediaValor*fatorSazonal;// 3. Disponível\nconst disponivel=mediaValor-dados.anoAtual.executado;const percentualExecutado=dados.anoAtual.executado/mediaValor*100;const percentualDisponivel=100-percentualExecutado;// 4. Gap\nconst gapContratos=dados.anoAtual.fechados-esperadoContratos;const gapPercentual=gapContratos/esperadoContratos*100;// 5. Projeção anual\nconst projecaoAno=dados.anoAtual.fechados/fatorSazonal;// 6. Diferença financeira\nconst diferencaFinanceira=dados.anoAtual.executado-esperadoValor;const diferencaFinanceiraPercent=diferencaFinanceira/esperadoValor*100;// 7. Orçamento livre (sem edital)\nconst orcamentoLivre=disponivel-dados.anoAtual.editaisAtivos.valor;// 8. Determinar nível de oportunidade\nlet nivel;if(gapPercentual<=-30){nivel='PREMIUM';}else if(gapPercentual<=-15){nivel='FORTE';}else{nivel='BOA';}return{municipio:dados.municipio,estado:dados.estado,categoria:dados.categoria,nivel,orcamento:{total:Math.round(mediaValor),executado:dados.anoAtual.executado,disponivel:Math.round(disponivel),percentualExecutado:Number(percentualExecutado.toFixed(1)),percentualDisponivel:Number(percentualDisponivel.toFixed(1))},contratos:{fechados:dados.anoAtual.fechados,mediaAnual:Math.round(mediaContratos),esperadoAteMes:Math.round(esperadoContratos),gap:Math.round(gapContratos),gapPercentual:Number(gapPercentual.toFixed(1)),projecaoAno:Math.round(projecaoAno)},oportunidades:{editaisAtivos:dados.anoAtual.editaisAtivos.quantidade,valorEditais:dados.anoAtual.editaisAtivos.valor,orcamentoLivre:Math.round(orcamentoLivre),diferencaFinanceira:Math.round(diferencaFinanceira),diferencaFinanceiraPercent:Number(diferencaFinanceiraPercent.toFixed(1))},historico:dados.historico.map(h=>({ano:h.ano,contratos:h.totalContratos,valorExecutado:h.valorExecutado,ticketMedio:Math.round(h.valorExecutado/h.totalContratos)})),comparacao:{esperadoContratos:Math.round(esperadoContratos),realContratos:dados.anoAtual.fechados,esperadoValor:Math.round(esperadoValor),realValor:dados.anoAtual.executado}};}// Formatadores de números\nexport const formatters={currency:value=>{return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',notation:'compact',maximumFractionDigits:2}).format(value);},number:value=>{return new Intl.NumberFormat('pt-BR').format(value);},percent:value=>{return\"\".concat(value>0?'+':'').concat(value.toFixed(1),\"%\");}};","map":{"version":3,"names":["calcularOportunidade","dados","mediaContratos","historico","reduce","acc","h","totalContratos","length","mediaValor","valorExecutado","fatorSazonal","esperadoContratos","esperadoValor","disponivel","anoAtual","executado","percentualExecutado","percentualDisponivel","gapContratos","fechados","gapPercentual","projecaoAno","diferencaFinanceira","diferencaFinanceiraPercent","orcamentoLivre","editaisAtivos","valor","nivel","municipio","estado","categoria","orcamento","total","Math","round","Number","toFixed","contratos","mediaAnual","esperadoAteMes","gap","oportunidades","quantidade","valorEditais","map","ano","ticketMedio","comparacao","realContratos","realValor","formatters","currency","value","Intl","NumberFormat","style","notation","maximumFractionDigits","format","number","percent","concat"],"sources":["/Users/gustavocarvalho/budget-dashboard/src/utils/oportunidadeCalculator.ts"],"sourcesContent":["// P0.2 - Função de Cálculo de Oportunidades\n\nimport { OportunidadeData, DadosHistoricos } from '../types/oportunidade';\n\nexport function calcularOportunidade(dados: DadosHistoricos): OportunidadeData {\n  // 1. Média histórica (2020-2024)\n  const mediaContratos = dados.historico.reduce((acc, h) => acc + h.totalContratos, 0) / dados.historico.length;\n  const mediaValor = dados.historico.reduce((acc, h) => acc + h.valorExecutado, 0) / dados.historico.length;\n\n  // 2. Ajuste sazonal (maio = 5/12 do ano)\n  const fatorSazonal = 5 / 12;\n  const esperadoContratos = mediaContratos * fatorSazonal;\n  const esperadoValor = mediaValor * fatorSazonal;\n\n  // 3. Disponível\n  const disponivel = mediaValor - dados.anoAtual.executado;\n  const percentualExecutado = (dados.anoAtual.executado / mediaValor) * 100;\n  const percentualDisponivel = 100 - percentualExecutado;\n\n  // 4. Gap\n  const gapContratos = dados.anoAtual.fechados - esperadoContratos;\n  const gapPercentual = (gapContratos / esperadoContratos) * 100;\n\n  // 5. Projeção anual\n  const projecaoAno = dados.anoAtual.fechados / fatorSazonal;\n\n  // 6. Diferença financeira\n  const diferencaFinanceira = dados.anoAtual.executado - esperadoValor;\n  const diferencaFinanceiraPercent = (diferencaFinanceira / esperadoValor) * 100;\n\n  // 7. Orçamento livre (sem edital)\n  const orcamentoLivre = disponivel - dados.anoAtual.editaisAtivos.valor;\n\n  // 8. Determinar nível de oportunidade\n  let nivel: 'PREMIUM' | 'FORTE' | 'BOA';\n  if (gapPercentual <= -30) {\n    nivel = 'PREMIUM';\n  } else if (gapPercentual <= -15) {\n    nivel = 'FORTE';\n  } else {\n    nivel = 'BOA';\n  }\n\n  return {\n    municipio: dados.municipio,\n    estado: dados.estado,\n    categoria: dados.categoria,\n    nivel,\n\n    orcamento: {\n      total: Math.round(mediaValor),\n      executado: dados.anoAtual.executado,\n      disponivel: Math.round(disponivel),\n      percentualExecutado: Number(percentualExecutado.toFixed(1)),\n      percentualDisponivel: Number(percentualDisponivel.toFixed(1))\n    },\n\n    contratos: {\n      fechados: dados.anoAtual.fechados,\n      mediaAnual: Math.round(mediaContratos),\n      esperadoAteMes: Math.round(esperadoContratos),\n      gap: Math.round(gapContratos),\n      gapPercentual: Number(gapPercentual.toFixed(1)),\n      projecaoAno: Math.round(projecaoAno)\n    },\n\n    oportunidades: {\n      editaisAtivos: dados.anoAtual.editaisAtivos.quantidade,\n      valorEditais: dados.anoAtual.editaisAtivos.valor,\n      orcamentoLivre: Math.round(orcamentoLivre),\n      diferencaFinanceira: Math.round(diferencaFinanceira),\n      diferencaFinanceiraPercent: Number(diferencaFinanceiraPercent.toFixed(1))\n    },\n\n    historico: dados.historico.map(h => ({\n      ano: h.ano,\n      contratos: h.totalContratos,\n      valorExecutado: h.valorExecutado,\n      ticketMedio: Math.round(h.valorExecutado / h.totalContratos)\n    })),\n\n    comparacao: {\n      esperadoContratos: Math.round(esperadoContratos),\n      realContratos: dados.anoAtual.fechados,\n      esperadoValor: Math.round(esperadoValor),\n      realValor: dados.anoAtual.executado\n    }\n  };\n}\n\n// Formatadores de números\nexport const formatters = {\n  currency: (value: number): string => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL',\n      notation: 'compact',\n      maximumFractionDigits: 2\n    }).format(value);\n  },\n\n  number: (value: number): string => {\n    return new Intl.NumberFormat('pt-BR').format(value);\n  },\n\n  percent: (value: number): string => {\n    return `${value > 0 ? '+' : ''}${value.toFixed(1)}%`;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}